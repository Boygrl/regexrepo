# Alienvault plugin
# Author: Alievault Team at devel@alienvault.com
# Plugin rsa-authentication-manager id:1803 version: 0.0.4
# Last modification: 2016-07-20 13:11
#
# Plugin Selection Info:
# RSA:Authentication Manager:-
#
# END-HEADER
# Accepted products:
# rsa - authentication_manager 8.0
# Description:
# 
# To capture the new event format
# 
# Matches general RSA events
#
[DEFAULT]
plugin_id=1803

[config]
type=detector
enable=yes
source=log
location=/var/log/rsa-auth-manager.log
create_file=true
process=
start=no
stop=no
startup=
shutdown=

[translation]
#Old sids
13001,FAIL=1300101
13001,SUCCESS=1300100
13002,FAIL=1300201
13002,SUCCESS=1300200
13003,FAIL=1300301
13003,SUCCCESS=1300300
23003,FAIL=2300301
23003,SUCCESS=2300300
23008,FAIL=2300801
23008,SUCCESS=2300800
23021,FAIL=2302101
23021,SUCCESS=2302100
23024,FAIL=2302401
23024,SUCCESS=2302400
23029,FAIL=2302901
23029,SUCCESS=2302900
23071,FAIL=2307101
23071,SUCCESS=2307100
23072,FAIL=2307201
23072,SUCCCESS=2307200
#New sids
AGENT_AUTO_REG_START=2
AUTHMGR_NEXT_TOKENCODE_ACTIVATED=3
AUTHN_LOGIN_EVENT=4
AUTH_PRINCIPAL_RESOLUTION=5
CONF_VALUE_UPDATED=6
CRITICAL_NOTIFICATION=7
INVALID_REPLICATION_STATE_REPLICA=8
RADIUS_REPLICATION=9
ADD_BATCH_JOB=10
ADJUDICATOR_REHOMING=11
AM_CLEAR_TOKEN_PIN=12
AM_DISABLE_PRINCIPAL_FOR_SMS=13
AM_ENABLE_PRINCIPAL_FOR_SMS=14
AM_LINK_TOKEN_PRINCIPAL=15
AM_RADIUS_CREATE_CLIENT=16
AM_RADIUS_REPLICATION_PUBLISH=17
AM_RADIUS_UPDATE_CLIENT=18
AM_REPLICAS_STUCK_SYNCHRONIZING=19
AM_REPLICA_SYNC_FAILED=20
AM_REPLICA_SYNC_SUCCEEDED=21
AM_SET_NEW_PIN_MODE=22
AM_START_REPLICA_SYNC=23
AM_TOKEN_DISABLED=24
AM_TOKEN_ENABLED=25
AM_UNLINK_TOKEN_PRINCIPAL=26
AM_UPDATE_SMS_FOR_PRINCIPAL=27
ARCHIVE_LOG=28
ARCHIVE_LOG_FILE_SIGN=29
AUTH_AGENT_ACCESS_CHECK=30
AUTH_FAILED_BAD_PIN_GOOD_TOKENCODE=31
AUTH_FAILED_BAD_PIN_PREVIOUS_TOKENCODE=32
AUTH_FAILED_BAD_TOKENCODE_GOOD_PIN=33
AUTH_LOG_REQUEST=34
AUTHMGR_AGENT_CREATE=35
AUTHMGR_AGENT_GROUP_LINK=36
AUTHMGR_AGENT_UPDATE=37
AUTHMGR_FILE_CREATE=38
AUTHMGR_FIXED_PASSCODE_CHANGE=39
AUTHMGR_NEW_PIN_REQUIRED=40
AUTHMGR_NEXT_TOKENCODE_ACTIVATED=41
AUTHMGR_PASSCODE_REUSE=42
AUTHMGR_PIN_CHANGE=43
AUTHMGR_SMS_PASSCODE_REUSE=44
AUTHMGR_SMS_PIN_CHANGE=45
AUTHMGR_TOKEN_POLICY_UPDATE=46
AUTHN_LOCKOUT_EVENT=47
AUTHN_LOGOUT_EVENT=48
AUTH_PRINCIPAL_RESOLUTION=49
AUTH_SESSION_OPEATION_FAILURE=50
CANCEL_BATCH_JOB=51
CLEANUP_EXPIRED_AUTHENTICATORS_JOB=52
CLU_AUDIT_LOG_COPY=53
CONF_VALUE_UPDATED=54
CREATE_GROUP=55
CREATE_REPORT_QUERY=56
DELETE_AGED_BACKUP=57
DELETE_BATCH_JOB=58
DELETE_SIGNING_KEY=59
ENABLED_EA_ONE_TIME_TOKENCODE=60
EXPORT_SOFT_TOKEN=61
GENERATED_EA_ONE_TIME_TOKENCODE=62
IMPORT_TOKEN=63
LINK_GROUP_PRINCIPAL=64
MANAGE_SMS_PIN=65
MESSAGE_HANDLER_HANDLE_MESSAGE=66
MOVE_PRINCIPAL_WITHIN_IDENTITYSOURCE=67
OC_ADMIN_LOGIN_EVENT=68
OC_ADMIN_LOGOUT_EVENT=69
OC_SCHEDULE_CREATE_BACKUP=70
RBA_UPDATE_MANAGER_INFO=71
READ_GROUP=72
READ_REPORT_DATA=73
REGISTER_PRINCIPAL=74
TEST_IDENTITY_SOURCE_CONN_FAILED=75
TRANSMIT_TXT_MSG_SMS=76
UPDATE_AM_PRINCIPAL=77
UPDATE_AM_TOKEN=78
UPDATE_EA_ONE_TIME_TOKENCODE=79
UPDATE_PRINCIPAL=80
UPDATE_PRINCIPAL_EXUID=81
UPDATE_PRINCIPAL_FOR_LDAP_CHANGE=82
UPDATE_PRINCIPAL_LOGINUID=83
OFFLINE_LOGIN_EVENT = 84
OA_DATA_DOWNLOAD = 85
OA_DATA_DOWNLOAD_FAILED = 86
AUTOREG_UNASSIGN_IP = 87
AUTOREG_UPDATE_AGENT = 88

[0001 - RSA - new rule]
event_type=event
regexp="(?P<syslog_date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s(?P<date>\d\d\d\d-\d\d-\d\d\s\d\d:\s\d\d:\d\d,\d+),.*?,\s+(?P<file>.*?),\s+(?P<sev>ERROR|INFO|SYSTEM|WARN),.*?,.*?,(?P<dst_ip>\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3})?,(?P<src_ip>\d{1,3}.\d{1,3}.\d{1,3}.\d{1,3}),(?P<sid>[^,]*),(?P<sid_temp>\d+,(?P<result>SUCCESS|FAIL|WARN)),(?P<msg_code>.*?),.*?,.*?,.*?,.*?,(?P<username>.*?),.*"
date={normalize_date($date)}
plugin_sid={translate($sid)}
device={resolv($src_ip)}
src_ip={resolv($src_ip)}
dst_ip={resolv($dst_ip)}
username={$username}
userdata1={$file}
userdata2={$sev}
userdata3={$result}
userdata4={$msg_code}

[0002 - RSA NG old rule Generic]
event_type=event
regexp="^(\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d\s(?P<date>\d\d\d\d-\d\d-\d\d\s\d\d:\s\d\d:\d\d,\d+),.*?,.*?,\s+(ERROR|INFO),.*,.*,(?P<sen>.*?),(?P<src_ip>.*?),.*?,(?P<sid_temp>\d+,(SUCCESS|FAIL)),(?P<msg_code>.*?),.*?,.*?,.*?,.*?,(?P<username>.*?),.*)$"
plugin_sid={translate($sid_temp)}
src_ip={$src_ip}
username={$username}
date={normalize_date($date)}
device={resolv($sen)}
userdata1={$msg_code}
userdata2={$sen}

[0099 - RSA - GENERIC]
event_type=event
regexp="(?P<date>\w{3}\s+\d{1,2}\s\d\d:\d\d:\d\d)\s(?P<device>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})"
date={normalize_date($date)}
plugin_sid=1
device={$device}
src_ip={$device}

