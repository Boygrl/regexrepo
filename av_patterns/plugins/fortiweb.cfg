# Alienvault plugin
# Author: Alienvault Team at devel@alienvault.com
# Plugin fortiweb id:1698 version: 0.0.4
# Last modification: 2016-07-04 14:00
#
# Plugin Selection Info:
# Fortinet:Fortiweb:-
#
# END-HEADER
# Accepted products:
# fortinet - fortiweb -
# fortinet - fortiweb-1000D -
# fortinet - fortiweb-400C -
# Description:
# 
#

[DEFAULT]
plugin_id=1698

[config]
type=detector
enable=yes

source=log
location=/var/log/fortiweb.log
create_file=false

process=
start=no
stop=no
restart=no
startup=
shutdown=

[translation]
_DEFAULT_=20000000

http=3
daemon=4

00001002=00001002	
00001012=00001012
00001052=00001052
00001062=00001062
00002202=00002202
00002801=00002801
00002802=00002802
00002811=00002811
00003401=00003401
00003402=00003402
00003411=00003411
00004401=00004401
00004402=00004402
00004411=00004411
00004902=00004902
00006001=00006001
00006002=00006002
00006011=00006011
00006102=00006102
00006202=00006202
00006302=00006302
00006501=00006501
00006502=00006502
00006511=00006511
00007302=00007302
00007402=00007402
00008101=00008101
00008102=00008102
00008111=00008111
00008602=00008602
00008701=00008701
00008702=00008702
00008711=00008711
00008801=00008801
00008811=00008811
00008901=00008901
00008911=00008911
00009001=00009001
00009011=00009011
00009101=00009101
00009111=00009111
00009201=00009201
00009211=00009211
00009301=00009301
00009311=00009311
00009401=00009401
00009402=00009402
00009411=00009411
00009501=00009501
00009502=00009502
00009511=00009511
00009702=00009702
00010001=00010001
00010002=00010002
00010011=00010011
00010201=00010201
00010202=00010202
00010211=00010211
00010401=00010401
00010402=00010402
00010411=00010411
00010501=00010501
00010502=00010502
00010511=00010511
00010601=00010601
00010602=00010602
00010611=00010611
00010701=00010701
00010711=00010711
00020088=00020088
00020201=00020201
00020202=00020202
00020211=00020211
00020301=00020301
00020302=00020302
00020311=00020311
00020801=00020801
00020802=00020802
00020811=00020811
00020901=00020901
00020902=00020902
00020911=00020911
00021002=00021002
00021102=00021102
00021140=00021140
00021202=00021202
00021302=00021302
00021234=00021234
00021402=00021402
00022997=00022997
00030001=00030001
00030002=00030002
00030011=00030011
00032006=00032006
00040001=00040001
00040002=00040002
00040011=00040011
00040301=00040301
00040302=00040302
00040311=00040311
00040501=00040501
00040502=00040502
00040511=00040511
00040601=00040601
00040611=00040611
00040623=00040623
00040751=00040751
00040752=00040752
00040761=00040761
00040801=00040801
00040802=00040802
00040811=00040811
00040901=00040901
00040902=00040902
00040911=00040911
00041001=00041001
00041002=00041002
00041011=00041011
00041101=00041101
00041102=00041102
00041111=00041111
00041201=00041201
00041202=00041202
00041211=00041211
00041302=00041302
00041401=00041401
00041402=00041402
00041411=00041411
00041601=00041601
00041602=00041602
00041611=00041611
00041801=00041801
00041802=00041802
00041811=00041811
00043001=00043001
00043002=00043002
00043011=00043011
00044001=00044001
00044002=00044002
00044011=00044011
00044401=00044401
00044411=00044411
00044501=00044501
00044502=00044502
00044511=00044511
00046001=00046001
00046002=00046002
00046011=00046011
00050001=00050001
00050002=00050002
00050011=00050011
00050201=00050201
00050202=00050202
00050211=00050211
00050401=00050401
00050402=00050402
00050411=00050411
00051001=00051001
00051002=00051002
00051011=00051011
00051201=00051201
00051202=00051202
00051211=00051211
00051401=00051401
00051402=00051402
00051411=00051411
00051601=00051601
00051602=00051602
00051611=00051611
00051801=00051801
00051802=00051802
00051811=00051811
00052201=00052201
00052202=00052202
00052211=00052211
00052401=00052401
00052402=00052402
00052411=00052411
00052601=00052601
00052602=00052602
00052611=00052611
00053201=00053201
00053202=00053202
00053211=00053211
00053701=00053701
00053711=00053711
00053901=00053901
00053902=00053902
00053911=00053911
00054401=00054401
00054402=00054402
00054411=00054411
00054601=00054601
00054602=00054602
00054611=00054611
00054801=00054801
00054802=00054802
00054811=00054811
00055301=00055301
00055302=00055302
00055311=00055311
00055501=00055501
00055502=00055502
00055511=00055511
00055701=00055701
00055702=00055702
00055711=00055711
00055901=00055901
00055902=00055902
00055911=00055911
00056401=00056401
00056402=00056402
00056411=00056411
00056601=00056601
00056602=00056602
00056611=00056611
00058601=00058601
00058602=00058602
00058611=00058611
00059801=00059801
00059802=00059802
00059811=00059811
00060001=00060001
00060002=00060002
00060011=00060011
00060201=00060201
00060202=00060202
00060211=00060211
00061201=00061201
00061202=00061202
00061211=00061211
00061401=00061401
00061402=00061402
00061411=00061411
00061801=00061801
00061802=00061802
00061811=00061811
00062001=00062001
00062002=00062002
00062011=00062011
00062201=00062201
00062202=00062202
00062211=00062211
00062401=00062401
00062402=00062402
00062411=00062411
00063401=00063401
00063402=00063402
00063411=00063411
00064401=00064401
00064402=00064402
00064411=00064411
00065002=00065002
00065501=00065501
00065502=00065502
00065511=00065511
00068001=00068001
00068002=00068002
00068011=00068011
00068301=00068301
00068302=00068302
00068311=00068311
00068401=00068401
00068402=00068402
00068411=00068411
00068701=00068701
00068711=00068711
00068801=00068801
00068802=00068802
00068811=00068811
00090001=00090001
00090002=00090002
00090011=00090011
00090101=00090101
00090102=00090102
00090111=00090111
00091101=00091101
00091102=00091102
00091111=00091111
00093001=00093001
00093002=00093002
00093011=00093011
00093501=00093501
00093502=00093502
00093511=00093511
10000009=10000009
10000010=10000010
10000011=10000011
10000012=10000012
10000013=10000013
10000014=10000014
10000015=10000015
10000016=10000016
10000017=10000017
10000018=10000018
10000019=10000019
10000020=10000020
10000021=10000021
10000022=10000022
10000023=10000023
10000027=10000027
10000028=10000028
10000034=10000034
10000038=10000038
10000042=10000042
11001008=11001008
11002003=11002003
11002004=11002004
11003601=11003601
11004002=11004002
11004601=11004601
11004602=11004602
11004603=11004603
11004605=11004605
11004606=11004606
11004608=11004608
11005901=11005901
11006004=11006004
11006005=11006005
11006006=11006006
11006701=11006701
19999496=19999496
19999497=19999497
19999498=19999498

#Attacks
waf_allow_method=20000001
allow_host=20000002
waf_page_rule=20000003
waf_start_page=20000004
waf_cookie_poison=20000005
waf_parameter_rule=20000006
waf_black_ip=20000007
waf_url_access=20000008
waf_custom_signature_match=20000009
waf_signature_detection=20000010
waf_hidden_fields=20000019
waf_brute_login=20000018
waf_custom_access=20000030
waf_header_overflow=20000032
waf_headline_overflow=20000033
waf_body_overflow=20000034
waf_content_overflow=20000035
waf_parameter_overflow=20000036
waf_request_overflow=20000037
waf_url_parameter_overflow=20000038
waf_illegal_http_version=20000039
waf_cookiecount_overflow=20000040
waf_req_headline_overflow=20000041
waf_ip_reputation=20000042
waf_url_parameter_count_overflow=20000043
waf_illegal_hostname=20000044
waf_illegal_file_type=20000045
DDOS based on HTTP session: waf_http_request_overflow=20000046
DDOS based on HTTP session: waf_tcp_connection_overflow=20000047
waf_max_num_ranges_in_Range_header=20000048
http_protocol_error=20000049
DDOS based on source IP: waf_http_request_overflow=20000050
DDOS based on source IP: waf_tcp_connection_overflow=20000051
https_connection_failed=20000052
waf_padding_oracle=20000053
waf_dos_prevention_type=21000022
waf_illegal_http_method=20000042
waf_information=00070011 
traffic=30000000



[0001 - Fortiweb attack waf_signature_detection]
event_type=event
precheck="waf_signature_detection"
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+).*?vd="(?P<vduser>[^"]*)"\s+timezone="[^"]*"\s+type=(?P<type>\S+)\s+subtype="(?P<subtype>[^"]*)"\s+pri=(?P<priority>\S+).*?severity_level=(?P<severity>\S+)\s+proto=(?P<protocol>\S+)\s+service=(?P<service>\S+).*?src=(?P<src_ip>\S+)\s+src_port=(?P<src_port>\S+)\s+dst=(?P<dst_ip>\S+)\s+dst_port=(?P<dst_port>\S+)\s+.*?http_url="(?P<url>[^"]*)"\s+http_host="(?P<host>[^"]*)".*?msg="(?P<msg>[^"]*)"\s+signature_subclass="(?P<signature_subclass>[^"]*)".*?srccountry="(?P<srccountry>[^"]*)"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($subtype)}
protocol={normalize_protocol($protocol)}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$dst_ip}
dst_port={$dst_port}
username={$vduser}
userdata1={$type}
userdata2={$signature_subclass}
userdata3={$priority}
userdata4={$severity}
userdata5={$url}
userdata6={$host}
userdata7={$service}
userdata8={$srccountry}
userdata9={$msg}

[0002 - Fortiweb attack]
event_type=event
precheck="type=attack"
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+).*?vd="(?P<vduser>[^"]*)"\s+timezone="[^"]*"\s+type=(?P<type>\S+)\s+subtype="(?P<subtype>[^"]*)"\s+pri=(?P<priority>\S+).*?severity_level=(?P<severity>\S+)\s+proto=(?P<protocol>\S+)\s+service=(?P<service>\S+).*?src=(?P<src_ip>\S+)\s+src_port=(?P<src_port>\S+)\s+dst=(?P<dst_ip>\S+)\s+dst_port=(?P<dst_port>\S+)\s+.*?http_url="(?P<url>[^"]*)"\s+http_host="(?P<host>[^"]*)".*?msg="(?P<msg>[^"]*)"\s+signature_subclass="(?P<signature_subclass>[^"]*)".*?srccountry="(?P<srccountry>[^"]*)"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($subtype)}
protocol={normalize_protocol($protocol)}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$dst_ip}
dst_port={$dst_port}
username={$vduser}
userdata1={$type}
userdata2={$subtype}
userdata3={$priority}
userdata4={$severity}
userdata5={$url}
userdata6={$host}
userdata7={$service}
userdata8={$srccountry}
userdata9={$msg}

[0003 - Fortiweb Attack no user no signature (400C)]
event_type=event
precheck="attack"
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+).*?type=(?P<type>\S+)\s+subtype="(?P<subtype>[^"]*)"\s+pri=(?P<priority>\S+).*?proto=(?P<protocol>\S+)\s+service=(?P<service>\S+).*?src=(?P<src_ip>\S+)\s+src_port=(?P<src_port>\S+)\s+dst=(?P<dst_ip>\S+)\s+dst_port=(?P<dst_port>\S+)\s+.*?http_url="(?P<url>[^"]*)"\s+http_host="(?P<host>[^"]*)".*?severity_level=(?P<severity>\S+).*?msg="(?P<msg>[^"]*)"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($subtype)}
protocol={normalize_protocol($protocol)}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$dst_ip}
dst_port={$dst_port}
userdata1={$type}
userdata2={$subtype}
userdata3={$priority}
userdata4={$severity}
userdata5={$url}
userdata6={$host}
userdata7={$service}
userdata9={$msg}

[0004 - Fortiweb traffic]
event_type=event
precheck="type=traffic"
regexp="(?P<date>\w+\s*\d+\s*\d+:\d+:\d+)\s+(?P<device>\S+)\s+.*?vd="(?P<vduser>[^"]*)"[\s+,]timezone="[^"]*"[\s+,]type=(?P<type>\S+?)[\s+,]subtype="(?P<subtype>[^"]*)"[\s+,]pri=(?P<priority>\S+?)[\s+,]proto=(?P<protocol>\S+?)[\s+,]service=(?P<service>\S+?)[\s+,].*?src=(?P<src_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})[\s+,]src_port=(?P<src_port>\d+)[\s+,]dst=(?P<dst_ip>\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})[\s+,]dst_port=(?P<dst_port>\d+).*?(?:http_url="(?P<url>[^"]*)"[\s*,]|msg="(?P<msg>[^"]*)"[\s*,]|srccountry="(?P<srccountry>[^"]*)",?\s*|http_host="(?P<host>[^"]*)"[\s*,]|http_agent="(?P<http_agent>[^"]*)"[\s*,]|http_retcode=(?P<ret_code>\d+)[\s*,])+"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($subtype)}
protocol={normalize_protocol($protocol)}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$dst_ip}
dst_port={$dst_port}
username={$vduser}
userdata1={$type}
userdata2={$subtype}
userdata3={$priority}
userdata4={$http_agent}
userdata5={$url}
userdata6={$host}
userdata7={$service}
userdata8={$srccountry}
userdata9={$msg}

[0005 - Fortiweb traffic no user (400C)]
event_type=event
precheck="type=traffic"
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+)\s+(?:\S+\s+){5}type=(?P<type>\S+)\s+subtype="(?P<subtype>[^"]*)"\s+pri=(?P<priority>\S+).*?proto=(?P<protocol>\S+)\s+service=(?P<service>\S+)\s+src=(?P<src_ip>\S+)\s+src_port=(?P<src_port>\S+)\s+dst=(?P<dst_ip>\S+)\s+dst_port=(?P<dst_port>\S+).*?http_host="(?P<host>[^"]*)".*?http_url="(?P<url>[^"]*)"\s+msg="(?P<msg>[^"]*)"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($subtype)}
protocol={normalize_protocol($protocol)}
src_ip={$src_ip}
src_port={$src_port}
dst_ip={$dst_ip}
dst_port={$dst_port}
userdata1={$type}
userdata2={$subtype}
userdata3={$priority}
userdata5={$url}
userdata6={$host}
userdata7={$service}
userdata9={$msg}

[0006 - Fortiweb event]
event_type=event
precheck="type=event"
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+).*?log_id=(?P<log_id>\d+).*?vd="(?P<vduser>[^"]*)"\s+timezone="[^"]*"\s+type=(?P<type>\S+)\s+subtype="(?P<subtype>[^"]*)"\s+pri=(?P<priority>\S+)\s+.*?msg="(?P<msg>[^"]*)"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($log_id)}
username={$vduser}
userdata1={$type}
userdata2={$subtype}
userdata9={$msg}

[0007 - Fortiweb event no user (400C)]
event_type=event
precheck="type=event"
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+).*?log_id=(?P<log_id>\d+).*?type=(?P<type>\S+)\s+subtype="(?P<subtype>[^"]*)"\s+pri=(?P<priority>\S+)\s+.*?msg="(?P<msg>[^"]*)"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($log_id)}
userdata1={$type}
userdata2={$subtype}
userdata9={$msg}

[0008 - Fortiweb debug no user (400C)]
event_type=event
precheck="type=debug"
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+)\s+(?:\S+\s+){5}type=(?P<type>\S+)\s+subtype="(?P<subtype>[^"]*)"\s+pri=(?P<priority>\S+)\s+.*?progname=(?P<progname>\S+)\s+msg="(?P<msg>[^"]*)"
date={normalize_date($date)}
device={$device}
plugin_sid={translate($subtype)}
userdata1={$type}
userdata2={$subtype}
userdata3={$progname}
userdata9={$msg}
