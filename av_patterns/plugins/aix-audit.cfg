# Alienvault plugin
# Author: Alienvault Team at avteam@alienvault.com
# Plugin aix-audit id:1649 version: 0.0.6
# Last modification: 2016-09-08 18:50
#
# Plugin Selection Info:
# IBM:Aix Audit:-
#
# END-HEADER
# Accepted products:
# ibm - aix 7.1
# Description:
# 
#
#

[DEFAULT]
plugin_id=1649

[config]
type=detector
enable=yes
source=log
location=/var/log/syslog
create_file=false

process=
start=no
stop=no
startup=
shutdown=

[translation]
AACCT_AddFile=1
AACCT_AddProj=2
AACCT_NotChange=3
AACCT_NotifyOff=4
AACCT_Off=5
AACCT_On=6
AACCT_PolLoad=7
AACCT_PolUnload=8
AACCT_PrIntOff=9
AACCT_PrIntSet=10
AACCT_ResetFile=11
AACCT_RmFile=12
AACCT_RmProj=13
AACCT_SwtchFile=14
AACCT_SwtchProj=15
AACCT_SysIntOff=16
AACCT_SysIntSet=17
AACCT_TridOff=18
AACCT_TridOn=19
ACCT_Disable=20
ACCT_Enable=21
AT_JobAdd=22
AT_JobRemove=23
AUD_Bin_Def=24
AUD_CONFIG_WR=25
AUD_Events=26
AUD_It=27
AUD_Lost_Recs=28
AUD_Objects=29
AUD_Proc=30
BACKUP_Export=31
BACKUP_Priv=32
CERT_Add=33
CERT_Create=34
CERT_Delete=35
CERT_Get=36
CERT_Link=37
CERT_List=38
CERT_Revoke=39
CERT_Verify=40
CFG_WRITE=41
CRON_Finish=42
CRON_JobAdd=43
CRON_JobRemove=44
CRON_Start=45
DEV_Change=46
DEV_Configure=47
DEV_Create=48
DEV_Remove=49
DEV_Start=50
DEV_Stop=51
DEV_UnConfigure=52
DSMIT_end=53
DSMIT_start=54
ENQUE_admin=55
ENQUE_exec=56
FILE_Accessx=57
FILE_Acl=58
FILE_Chpriv=59
FILE_Close=60
FILE_Dupfd=61
FILE_Facl=62
FILE_Fchmod=63
FILE_Fchown=64
FILE_Fchpriv=65
FILE_FReadXacl=66
FILE_Frevoke=67
FILE_FWriteXacl=68
FILE_Link=69
FILE_Mknod=70
FILE_Mode=71
FILE_Open=72
FILE_Owner=73
FILE_Pipe=74
FILE_Privilege=75
FILE_Read=76
FILE_ReadXacl=77
FILE_Rename=78
FILE_Revoke=79
FILE_Stat=80
FILE_StatAcl=81
FILE_StatPriv=82
FILE_Symlink=83
FILE_Truncate=84
FILE_Unlink=85
FILE_Utimes=86
FILE_Write=87
FILE_WriteXacl=88
FS_Chdir=89
FS_Chroot=90
FS_Extend=91
FS_Fchdir=92
FS_Mkdir=93
FS_Mount=94
FS_Rmdir=95
FS_Umount=96
GROUP_Adms=97
GROUP_Change=98
GROUP_Create=99
GROUP_Remove=100
GROUP_User=101
IKE_activat_cmd=102
IKE_remove_cmd=103
IKE_tnl_creat=104
IKE_tnl_delet=105
INIT_End=106
INIT_Start=107
INSTALLP_Exec=108
INSTALLP_Inst=109
KEY_Add=110
KEY_Delete=111
KEY_List=112
KEY_PasswordChange=113
LDAP_Add=114
LDAP_Bind=115
LDAP_Compare=116
LDAP_Delete=117
LDAP_Modify=118
LDAP_Modifydn=119
LDAP_Search=120
LDAP_Unbind=121
LVM_AddLV=122
LVM_AddMissPV=123
LVM_AddPV=124
LVM_AddVGSA=125
LVM_AvoidLV=126
LVM_ChangeLV=127
LVM_ChangeVG=128
LVM_Chg1016=129
LVM_ChgQuorum=130
LVM_CreateLV=131
LVM_CreateVG=132
LVM_DefineVG=133
LVM_DeleteLV=134
LVM_DeletePV=135
LVM_DeleteVG=136
LVM_DeleteVGSA=137
LVM_ExtendLV=138
LVM_KChangeLV=139
LVM_KDeleteLV=140
LVM_KDeleteVG=141
LVM_LockDisk=142
LVM_MissingPV=143
LVM_ReduceLV=144
LVM_RemovePV=145
LVM_SetupVG=146
LVM_UnlockDisk=147
LVM_VaryoffVG=148
LVM_VaryonVG=149
MAIL_ToUser=150
MSG_Create=151
MSG_Delete=152
MSG_Mode=153
MSG_Owner=154
MSG_Read=155
MSG_Write=156
NVRAM_Config=157
PASSWORD_Change=158
PASSWORD_Check=159
PASSWORD_Ckerr=160
PASSWORD_Flags=161
PORT_Change=162
PORT_Locked=163
PROC_Adjtime=164
PROC_AuditID=165
PROC_ChkAuth=166
PROC_Create=167
PROC_Debug=168
PROC_Delete=169
PROC_Environ=170
PROC_Execute=171
PROC_Kill=172
PROC_Limits=173
PROC_Load=174
PROC_LoadError=175
PROC_LoadMember=176
PROC_LPExecute=177
PROC_RealGID=178
PROC_RealUID=179
PROC_Reboot=180
PROC_SetGroups=181
PROC_Setpgid=182
PROC_Setpri=183
PROC_SetPri=184
PROC_SetRoles=185
PROC_SetSignal=186
PROC_Settimer=187
PROC_SetUserIDs=188
PROC_Sysconfig=189
PROC_SysParm=190
RESTORE_Import=191
ROC_Privilege=192
ROLE_Change=193
ROLE_Create=194
ROLE_Remove=195
RTMQ_Close=196
RTMQ_Getattr=197
RTMQ_Notify=198
RTMQ_NotifyCanc=199
RTMQ_Open=200
RTMQ_Receive=201
RTMQ_Send=202
RTMQ_Setattr=203
RTMQ_Unlink=204
RTSEM_Close=205
RTSEM_Destroy=206
RTSEM_Getvalue=207
RTSEM_Init=208
RTSEM_Open=209
RTSEM_Post=210
RTSEM_TryWait=211
RTSEM_Unlink=212
RTSEM_Wait=213
RTSHM_Open=214
RTSHM_Unlink=215
S_ENVIRON_WRITE=216
S_GROUP_WRITE=217
S_LIMITS_WRITE=218
S_LOGIN_WRITE=219
S_PASSWD_READ=220
S_PASSWD_WRITE=221
S_USER_WRITE=222
SEC_aclxcntl=223
SEDMGR_File=224
SEDMGR_Odm=225
SEM_Create=226
SEM_Delete=227
SEM_Mode=228
SEM_Op=229
SEM_Owner=230
SENDMAIL_Config=231
SENDMAIL_ToFile=232
SHM_Close=233
SHM_Create=234
SHM_Detach=235
SHM_LPCreate=236
SHM_Mode=237
SHM_Open=238
SHM_Owner=239
SRC_Addserver=240
SRC_Addssys=241
SRC_Chserver=242
SRC_Chssys=243
SRC_Delserver=244
SRC_Delssys=245
SRC_Start=246
SRC_Stop=247
SYSCK_Check=248
SYSCK_Delete=249
SYSCK_Install=250
SYSCK_Update=251
TCB_Exec=252
TCB_Leak=253
TCB_Mod=254
TCBCK_Check=255
TCBCK_Delete=256
TCBCK_Update=257
TCP_kaccept=258
TCP_kbind=259
TCP_kclose=260
TCP_kconnect=261
TCP_klisten=262
TCP_kreceive=263
TCP_ksend=264
TCP_ksetopt=265
TCP_kshutdown=266
TCP_ksocket=267
TCP_ksocketpair=268
TCPIP_access=269
TCPIP_config=270
TCPIP_connect=271
TCPIP_data_in=272
TCPIP_data_out=273
TCPIP_host_id=274
TCPIP_route=275
TCPIP_set_time=276
TE_FileWrite=277
TE_Policies=278
TE_Untrusted=279
TE_VerifyAttr=280
TEAdd_Stnz=281
TEDel_Stnz=282
TEQuery_Stnz=283
TERM_Logout=284
TESwitch_algo=285
TSDTPolicy=286
USER_Change=287
USER_Check=288
USER_Create=289
USER_Exit=290
USER_Login=291
USER_Logout=292
USER_PagDelete=293
USER_Paginit=294
USER_Reboot=295
USER_Remove=296
USER_SetEnv=297
USER_SetGroups=298
USER_Shell=299
USER_SU=300
USRCK_Error=301
ECH_CANNOT_SET_CLBK=302
failed login attempt=311
Login successful=310
EXPORT=304
telnet=305
telnetd=305
sendmail=231
Accepted password=306
Accepted publickey=307
Received disconnect=308
subsystem request=309
Failed password=312
Could not load host key=313
Too many authentication failures=314
restart=315
sent status Operation unsupported=316
opendir=317
closedir=318
session closed=319
session opened=320
open=321
close=322
remove name=323
set=324


_DEFAULT_=20000000



[0001 - Aix-audit 7.1 - Unix: Privelege command]
event_type=event
precheck="The privilege command"
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?:Message\sforwarded\sfrom\s)?(?P<device>[^:]+):\s(?P<syslog_tag>[^:]+):\s+(?:The privilege command (?P<path>[^,]+), is executed by user with id (?P<user_id>\d+))"
date={normalize_date($date)}  
device={resolv($device)}
plugin_sid=303   
userdata1={$path}           
userdata2={$user_id}


[0002 - Aix-audit 7.1 - Login]
event_type=event
precheck="for"
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?:Message\sforwarded\sfrom\s)?(?P<device>[^:]+):\s(?P<syslog_tag>[^:]+):\s+(?P<method>[^:]+)?:?\s?(?P<sid>failed\slogin\sattempt|Login\ssuccessful)\sfor\s(?P<username>\S+)(?:\sfrom\s(?P<src_ip>\S+))?(?:\son\s(?P<path>\S+))?"
date={normalize_date($date)} 
device={resolv($device)} 
plugin_sid={translate($sid)}  
src_ip={resolv($src_ip)}        
username={$username}  
userdata1={$sid}             
userdata2={$method}  
userdata3={$path}
     

[0003 - Aix-audit 7.1 - FTP, export]
event_type=event
precheck="EXPORT"
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?:Message\sforwarded\sfrom\s)?(?P<device>[^:]+):\s(?P<syslog_tag>[^:]+):\s+(?P<protocol>[^:]+):\s(?P<sid>EXPORT)\suser\s(?P<username>[^,]+),\shost\s(?P<src_ip>[^,]+),\slocal\s(?P<local>[^,]+),\sremote\s(?P<remote>[^.]+)"
date={normalize_date($date)}   
device={resolv($device)}
plugin_sid={translate($sid)} 
src_ip={resolv($src_ip)}    
protocol={normalize_protocol($protocol)}  
username={$username}                 
userdata1={$local}
userdata2={$remote}               


[0004 - Aix-audit 7.1 Telnet]
event_type=event
precheck="telnet"
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?:Message\sforwarded\sfrom\s)?(?P<device>[^:]+):\s(?P<syslog_tag>[^:]+):\s+(?P<sid>telnet(?:\w+)?)(?::\s(?P<message>.*)|\sfrom\s::ffff:(?P<src_ip>\S+)\son\s(?P<path>\S+))"
date={normalize_date($date)}  
device={resolv($device)}
plugin_sid={translate($sid)}  
src_ip={resolv($src_ip)}
dst_ip={resolv($device)}  
userdata1={$message}
userdata2={$path}   
    

[0005 - Aix-audit 7.1 - SSH Connection/Disconnection ]
event_type=event
precheck="ssh"
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s(?:Message\sforwarded\sfrom\s)?(?P<device>\S+):\s(?P<syslog_tag>sshd)[^:]+:\s(?P<sid>(?:Accepted|Failed)\s(?:password|publickey)|Received\sdisconnect)\s(?:for\s(?P<username>\S+)\s)?from\s(?P<src_ip>\S+)\s(?:port\s)?(?P<src_port>[^:\s]+):?\s(?P<protocol>ssh2)?"
date={normalize_date($date)}  
device={resolv($device)}
plugin_sid={translate($sid)}  
src_ip={resolv($src_ip)} 
src_port={$src_port}
dst_ip={resolv($device)}  
username={$username}
userdata1={$protocol} 


[0006 - Aix-audit 7.1 SSH Request]
event_type=event
precheck="ssh"
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?:Message\sforwarded\sfrom\s)?(?P<device>[^:\s]+):?\s(?P<syslog_tag>sshd)[^:]+:\s(?:[^:]+:\s)?(?P<sid>subsystem\srequest|Could\snot\sload\shost\skey|Too\smany\sauthentication\sfailures).*?(?:(?:\sfor\s(?P<protocol>\S+)\sby\suser|\sfor)\s(?P<username>\S+))?(?:.*?(?P<path>/\S+))?"
date={normalize_date($date)}  
device={resolv($device)}
plugin_sid={translate($sid)}
username={$username}
filename={$path}
userdata1={$protocol}


[0007 - Aix-audit 7.1 sendmail]
event_type=event
precheck="sendmail"
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?:Message\sforwarded\sfrom\s)?(?P<device>[^:\s]+)[\s:]+(?P<sid>sendmail)[^:]+:\s(?:[^:]+:\sfrom=(?P<src_user>[^,]+)|[^:]+:\sto=(?P<dst_user>[^,]+)|.*?host\sname\s\((?P<host_name>[^)]+))?"
date={normalize_date($date)}  
device={resolv($device)}
plugin_sid={translate($sid)} 
username={$host_name}
userdata1={$src_user}
userdata2={$dst_user}

#   Jul 12 11:50:21 server2 AIXAudit	3	287	mar jul 12 11:50:21 2011	FILE_Mode	su	root	user1	14286906	13566132	OK	mode: 600 filename /var/adm/sulog
#   Mar 21 17:29:00 server1 AIXAudit#0113#01111431#011mie mar 21 17:29:00 2012#011S_PASSWD_READ#011sendmail#011daemon#011root#01118284586#01115859818#011OK#011audit object read event detected /etc/security/passwd
[0008 - aix-audit-generic-event-control-characters-on]
event_type=event
regexp="(?P<sys_date>\w{3}\s*\S+\s*\d+:\d+:\d+)\s+(?P<device>\S+)\s+(?P<typelog>\S+?)(?:#011|\t)(?P<statusN>\d+?)(?:#011|\t)(?P<data_number>\d+?)(?:#011|\t)(?P<date>.+? \w{3} \d{1,2}\d{1,2} \d{1,2}:\d{1,2}\d{1,2}:\d{1,2} \d{4})(?:#011|\t)(?P<event_type>\S+?)(?:#011|\t)(?P<command>\S+?)(?:#011|\t)(?P<username>\S+?)(?:#011|\t)(?P<user>\S+?)(?:#011|\t)(?P<n1>\d+?)(?:#011|\t)(?P<n2>\d+)(?:#011|\t)(?P<status>\S+?)(?:#011|\t)(?P<trail>.+)"
date={normalize_date($sys_date)}
plugin_sid={translate($event_type)}
device={resolv($device)}
src_ip={resolv($device)}
username={$user}
userdata1={$typelog}
userdata2={$command}
userdata3={$statusN}
userdata4={$trail}
userdata5={$status}

[0009 - Aix-audit 7.1 syslog restart and sftp-server]
event_type=event
regexp="(?P<date>\S+\s+\d+\s+\d\d:\d\d:\d\d)\s+(?:Message\sforwarded\sfrom\s)?(?P<device>[^:\s]+)[\s:]+[^:]+:\s(?P<sid>session\s(?:opened|closed)|(?:open|close)dir|open|close|set|remove\sname|.*)\s(?:for\slocal\suser\s(?P<username>\S+)\sfrom\s\[(?P<src_ip>[^]]+)|"(?P<path>[^"]+)"(?:\sflags\s(?P<permission>.*?)mode)?)?"
date={normalize_date($date)}  
device={resolv($device)}
plugin_sid={translate($sid)} 
src_ip={resolv($src_ip)}
username={$username}
filename={$path}
userdata1={$permission}

            
[0010 - aix-audit multiline log format 1]
event_type=event
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<device>\S+)\s+(?:\S+):\s+(?P<sid>\S+)\s+(?P<user>\S+)\s+(?P<status>\S+)\s+\w+\s+\w+\s\d+\s\d\d:\d\d:\d\d\s\d+\s(?P<command>\S+)\s*\S*\s+\n\S+\s\S+\s\S+\s+(?P<src_ip>\S+)[^/]+(?P<filename>[^.]+.[^/\s]+)?(?:[^\s]+\s+[^/]+(?P<filename2>[^.\s]+.[^/\s]+))?"
date={normalize_date($date)}
device={resolv($device)}
plugin_sid={translate($sid)}
src_ip={resolv($src_ip)}
filename={$filename}
username={$user}
userdata1={$status}
userdata2={$command}
userdata3={$filename2}

[0011 - aix-audit multiline log format 2]
event_type=event
regexp="(?P<date>\SYSLOG_DATE)\s+(?P<src_ip>\S+)\s+(\S+):\s+LABEL:\s+(?P<sid>\S+)\s*\n\SYSLOG_DATE\s+\S+\s+(\S+):\s+IDENTIFIER:\s+(?P<identifier>\S+)\s*\n\SYSLOG_DATE\s+\S+\s+(\S+):\s*\n\SYSLOG_DATE\s+\S+\s+(\S+):.*\n\SYSLOG_DATE\s+\S+\s+(\S+):\sSequence\sNumber:\s(?P<sequence_number>\d+)\s*\n\SYSLOG_DATE\s+\S+\s+(\S+):\sMachine\sId:\s*(?P<machine_id>\S+)\s*\n\SYSLOG_DATE\s+\S+\s+(\S+):\sNode\sId:\s*(?P<node_id>\S+)\s*\n\SYSLOG_DATE\s+\S+\s+(\S+):.*\n\SYSLOG_DATE\s+\S+\s+(\S+):.*\n\SYSLOG_DATE\s+\S+\s+(\S+):.*\n\SYSLOG_DATE\s+\S+\s+(\S+):.*\n\SYSLOG_DATE\s+\S+\s+(\S+):.*\n\SYSLOG_DATE\s+\S+\s+(\S+):\sDescription.*?\n\SYSLOG_DATE\s+\S+\s+(\S+):\s(?P<description>.*)"
date={normalize_date($date)}
plugin_sid={translate($sid)}
src_ip={resolv($src_ip)}
userdata1={$identifier}
userdata2={$sequence_number}
userdata3={$machine_id}
userdata4={$node_id}
userdata5={$description}
